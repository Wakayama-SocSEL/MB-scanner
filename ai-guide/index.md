# AI Guide Index - MB-search 開発ガイド

本ディレクトリは、リポジトリでコードを扱う際の AI 支援開発用ガイドです。AI エージェントからアクセスされた場合は、以下の手順を順守してください。

1. **初期確認**: この `index.md` を読み、全体ルールと最新の目次を把握してください。
2. **必要に応じた読込**: 作業内容に応じて、下記「ファイル一覧」から該当トピックのみを読み込んでください。不要なファイルは開かず、コンテキスト長を節約します。
3. **ドキュメント更新時の流れ**:
    1. 新しいトピックを追加する場合は、まずこのファイルにリンクと 1 行程度の概要を追記します。
    2. 続いて個別ファイル（例：`ai-guide/architecture.md`、`ai-guide/cli-design.md` など）を作成または更新します。
    3. 既存トピックの拡張でも、目次と概要が最新か確認し、必要なら修正してください。
4. **タスクの進め方と作業記録 (必須)**:
    タスクに着手する前に、まずそのタスクの名称（例： `feature-name` や `fix-bug-name`）をユーザーと合意してください。
    作業記録を保存するため、プロジェクトルートの `.ai/tasks/` 配下に、**4桁の連番**と合意したタスク名称でディレクトリ（例: `.ai/tasks/0001-feature-name`）を作成してください。連番は既存のディレクトリと重複しないように決定します。

    作業プロセスは以下を厳格に順守してください。

    a. **プロンプトの保存**: ユーザーからのタスク指示（プロンプト）を、作成したディレクトリ内にマークダウンファイルとして保存します。
        - **ファイル名**: `prompt.md` (例: `.ai/tasks/0001-feature-name/prompt.md`)
    b. **実装計画の作成と保存**: 次に、そのプロンプトに基づく詳細な実装計画（**必要なテストケース一覧を含む**）をマークダウン形式で作成し、同ディレクトリに保存します。
        - **ファイル名**: `plan.md` (例: `.ai/tasks/0001-feature-name/plan.md`)
    c. **計画の承認**: 作成した `plan.md` の内容をユーザーに提示し、承認を得てください。**承認なしに実装を開始してはいけません。**
    d. **テストコードの先行作成 (TDD)**: 計画が承認されたら、まず計画に基づいた**テストコード**を作成します。この時点では、実装が存在しないためテストは失敗します。
    e. **実装**: テストコードが作成されたら、そのテストが**すべてパスする**ように実装コードを作成します。
    f. **目的とコンテキスト復元**: この `prompt.md` と `plan.md` への保存は、AIの会話履歴が要約（Compact）されたり、セッションが長時間にわたったりした場合に、タスクの**元の要求**と**承認された計画**を正確に思い出すための「記憶フック」として機能します。作業が中断・再開された場合は、これらのファイルを読み直してコンテキストを復元してください。
5. **作業完了時のチェック**: コード実装後は `pytest`、`just fix`、`just typecheck` を必ず実行し、結果を共有してください。

## 全体ルール

全てのやりとりは日本語で行ってください。

新しい機能やサービス層を実装する際は、必ずテストも作成してください。テストなしでの実装は受け入れられません。

コードの実装が終わった段階で、必ず以下のコマンドを実行してコード品質を確認してください：
- `pytest`: テストを実行して全てパスすることを確認
- `just fix`: コードのフォーマットと自動修正を実行
- `just typecheck`: 型チェックを実行

## ファイル一覧

以下を参照してください。

1. [project-overview.md](./project-overview.md) - プロジェクト概要
2. [db-design.md](./db-design.md) - データベース設計ドキュメント
3. [testing-guidelines.md](./testing-guidelines.md) - テストガイドライン（必読）
